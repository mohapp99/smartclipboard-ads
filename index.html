<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartClipboard Ads</title>
  <meta name="google-adsense-account" content="ca-pub-4439906628582965">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4439906628582965"
          crossorigin="anonymous"></script>

  <style>
    body, html {
      margin: 0;
      padding: 10px;
      font-family: 'Segoe UI', sans-serif;
      background-color: #2D2D2D;
      color: #E6E6EB;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      overflow: hidden;
    }
    .ad-container {
      width: 100%;
    }
    a {
      color: #78A0FF;
      text-decoration: none;
      font-weight: bold;
    }
    img, video {
      max-width: 100%;
      border-radius: 8px;
      border: 1px solid #464650;
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="ad-container" id="adContainer">
    <p>Chargement des publicit√©s...</p>
  </div>

  <script>
    // Variable globale pour stocker la liste des fichiers locaux
    let localAdFiles = [];
    let currentAdTimeout = null; // Pour g√©rer le timer de rotation

    /****************************************************
     * üéØ V√©rifie la connexion Internet
     ****************************************************/
    async function hasInternetConnection() {
      try {
        const online = window.navigator.onLine;
        if (!online) return false;
        const response = await fetch("https://www.gstatic.com/generate_204", { method: "HEAD", cache: "no-store" });
        return response.ok;
      } catch {
        return false;
      }
    }

    /****************************************************
     * üîπ Affiche le bloc Google AdSense
     ****************************************************/
    function showAdSense() {
      const container = document.getElementById("adContainer");
      container.innerHTML = `
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4439906628582965"
             data-ad-slot="7584788658"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>`;
      (adsbygoogle = window.adsbygoogle || []).push({});
    }

    /****************************************************
     * üîπ Affiche une publicit√© locale (image ou vid√©o)
     *    et g√®re la rotation.
     ****************************************************/
    function showNextLocalAd() {
      const container = document.getElementById("adContainer");
      // S'assure que la rotation pr√©c√©dente est arr√™t√©e
      if (currentAdTimeout) clearTimeout(currentAdTimeout);

      if (!localAdFiles || localAdFiles.length === 0) {
        container.innerHTML = "<p>Aucune publicit√© locale trouv√©e.</p>";
        return;
      }

      // Choisit un fichier al√©atoire dans la liste
      const randomFile = localAdFiles[Math.floor(Math.random() * localAdFiles.length)];
      const ext = randomFile.split('.').pop().toLowerCase();

      let mediaHTML = "";
      let isVideo = false;

      // G√©n√®re le HTML en fonction du type de fichier
      if (["mp4", "webm", "avi"].includes(ext)) {
        mediaHTML = `<video id="localVideoAd" src="${randomFile}" autoplay muted></video>`;
        isVideo = true;
      } else if (["jpg", "jpeg", "png", "gif"].includes(ext)) {
        mediaHTML = `<img src="${randomFile}" alt="Publicit√©">`;
      }

      // Affiche la publicit√©
      container.innerHTML = `
        ${mediaHTML}
      `;

      // G√®re la rotation
      if (isVideo) {
        const videoElement = document.getElementById("localVideoAd");
        // Passe √† la pub suivante √† la fin de la vid√©o
        videoElement.onended = showNextLocalAd;
        // S√©curit√© : si la vid√©o ne se charge pas, rotation apr√®s 60s
        currentAdTimeout = setTimeout(showNextLocalAd, 60000);
      } else {
        // Pour les images, passe √† la pub suivante apr√®s 30 secondes
        currentAdTimeout = setTimeout(showNextLocalAd, 30000);
      }
    }

    /****************************************************
     * üîπ Point d‚Äôentr√©e principal
     ****************************************************/
    (async () => {
      // 1. V√©rifie la connexion Internet
      const online = await hasInternetConnection();

      if (online) {
        // 2a. Si en ligne, affiche les publicit√©s Google AdSense
        showAdSense();
      } else {
        // 2b. Si hors ligne, demande la liste des fichiers locaux √† l'application C#
        window.chrome.webview.postMessage("requestLocalAds");
      }
    })();

    /****************************************************
     * üîπ R√©ception des fichiers depuis C#
     ****************************************************/
    window.chrome?.webview?.addEventListener("message", event => {
      // Cet √©couteur est d√©clench√© √† la fois pour la demande initiale
      // et pour toute mise √† jour envoy√©e par l'application C#.
      if (event.data && event.data.localAds) {
        console.log("Mise √† jour de la liste des publicit√©s locales re√ßue.");
        localAdFiles = event.data.localAds; // Met √† jour la liste des fichiers.
        // Red√©marre la rotation avec la nouvelle liste.
        showNextLocalAd(); // Affiche la premi√®re publicit√© et d√©marre la rotation
      }
    });
  </script>
</body>
</html>


  -->
</body>
</html>
